# Short Link Service

Консольный сервис для создания и управления короткими ссылками с ограничением переходов и временем жизни.

![Java](https://img.shields.io/badge/Java-21-blue)
![Maven](https://img.shields.io/badge/Maven-3.6+-orange)
![License](https://img.shields.io/badge/License-MIT-green)
![Tests](https://img.shields.io/badge/Tests-Passing-brightgreen)

## Оглавление

- [Особенности](#особенности)
- [Быстрый старт](#быстрый-старт)
- [Использование](#использование)
- [Архитектура](#архитектура)
- [Конфигурация](#конфигурация)

## Особенности

### Основной функционал

- Уникальные короткие ссылки для каждого пользователя.
- Лимит переходов с автоматической блокировкой.
- Время жизни ссылок (TTL) с автоудалением.
- UUID-идентификация пользователей без авторизации.
- Автоматическое открытие в браузере.
- Уведомления о событиях в консоли.

### Расширенные возможности

- Управление ссылками: изменение лимитов, продление срока, удаление.
- Детальная статистика по кликам и активности.
- Конфигурирование через внешний файл.
- Фоновая очистка истекших ссылок.
- Потокобезопасные операции.
- Валидация входных данных.

## Установка

### Требования

- Java 21 или выше
- Maven 3.6+

### Установка

1. Клонирование репозитория:

   bash
   git clone https://github.com/Dmitry-Klepikov/shortLinkService.git
   cd shortLinkService
   
2. Сборка проекта:

   bash
   mvn clean package
   
### Запуск

- Через Maven:

  bash
  mvn exec:java
  
- Или собранным JAR:

  bash
  java -jar target/shortLinkService-1.0-SNAPSHOT.jar
  
## Использование

После запуска откроется интерактивная консоль. Введите help для списка команд.

### Основные команды

| Команда | Описание | Пример |
|---|---|---|
| new | Зарегистрировать нового пользователя | new |
| shorten [URL] | Создать короткую ссылку | shorten https://example.com |
| open [CODE] | Открыть короткую ссылку | open abc123 |
| my | Показать все мои ссылки | my |
| stats | Показать статистику | stats |
| edit CODE [LIMIT] | Изменить лимит кликов | edit abc123 50 |
| extend CODE [DAYS] | Продлить срок жизни | extend abc123 7 |
| delete CODE | Удалить ссылку | delete abc123 |
| help | Показать справку | help |
| exit | Выйти из программы | exit |

### Пример работы new
Пользователь создан: 550e8400-e29b-41d4-a716-446655440000
Сохраните этот ID для доступа к вашим ссылкам

> shorten https://github.com
Макс. кликов [100]: 50
Создана: http://clck.ru/abc123

> open abc123
Результат: https://github.com
Открываю: https://github.com

> stats
Статистика пользователя 550e8400-e29b-41d4-a716-446655440000:
  Всего ссылок: 1
  Активных: 1
  Истекших: 0
  Всего кликов: 1
  Среднее кликов на ссылку: 1

### Настройки по умолчанию

- При создании ссылки лимит кликов по умолчанию - 100.
- Срок жизни ссылки по умолчанию - 1 день.
- Длина короткого кода - 6 символов.
- Все параметры настраиваются в конфигурации.

## Архитектура

Проект построен по принципам чистой архитектуры с разделением на слои:

1. Доменный слой (Domain Layer) - Сердце приложения
Этот слой содержит бизнес-логику и не зависит от внешних компонентов.

ShortUrl - ключевая бизнес-сущность, представляющая короткую ссылку с полями:

userId - UUID владельца

originalUrl - оригинальный URL

shortCode - сгенерированный короткий код

clickCount - счетчик переходов

maxClicks - лимит кликов

expiresAt - срок действия

isActive() - метод проверки активности

UrlShrinkDomainService - основной сервис доменной логики:

- Создание коротких ссылок

- Валидация URL и лимитов

- Обработка переходов по ссылкам

- Управление состоянием ссылок

NotificationService - интерфейс для системы уведомлений

2. Инфраструктурный слой (Infrastructure Layer) - Техническая реализация
Содержит конкретные реализации интерфейсов, зависимые от внешних технологий.

InMemoryUrlRepository - репозиторий для хранения данных в оперативной памяти:

- Использует ConcurrentHashMap для потокобезопасности

- Автоматическая очистка истекших записей

- Индексация по пользователям и коротким кодам

ShortCodeGenerator - генератор уникальных коротких кодов:

- Основан на SHA-256 хешировании

- Гарантирует уникальность для каждого пользователя

- Настраиваемая длина кода

ConsoleNotificationService - реализация уведомлений через консоль

3. Прикладной слой (Application Layer) - Координация
Организует взаимодействие между слоями, не содержит бизнес-логики.

UrlShrinkApplicationService - координатор операций:

- Преобразует пользовательские команды в вызовы доменного слоя

- Обрабатывает исключения

- Возвращает результаты в удобном формате

4. Презентационный слой (Presentation Layer) - Интерфейс пользователя
UrlShrinkerApp - консольное приложение:

- Обработка команд пользователя

- Отображение результатов

- Взаимодействие с браузером

### Ключевые компоненты

1. UrlShrinkDomainService - ядро бизнес-логики:
   - Создание и валидация ссылок
   - Обработка переходов
   - Управление состоянием
   - Уведомления

2. InMemoryUrlRepository - хранилище в памяти:
   - Быстрые операции поиска
   - Автоочистка истекших записей
   - Потокобезопасные коллекции

3. ShortCodeGenerator - генератор кодов:
   - SHA-256 хеширование
   - Гарантия уникальности
   - Настраиваемая длина

## Конфигурация

Все настройки вынесены в src/main/resources/application.properties:
- Базовый URL для коротких ссылок
app.base-url=http://clck.ru/

- Срок жизни ссылки по умолчанию (дни)
app.default-ttl-days=1

- Лимит кликов по умолчанию
app.default-max-clicks=100

- Длина короткого кода
app.short-code-length=6

Тестирование
Запуск тестов
bash
# Все тесты
mvn test

# С отчетом о покрытии
mvn clean test jacoco:report
Структура тестов
text
src/test/java/com/shortUrlService/
├── domain/
│   ├── model/
│   │   └── ShortUrlTest.java          # Unit-тесты сущности
│   └── service/
│       └── UrlShrinkDomainServiceTest.java # Интеграционные тесты
└── infrastructure/
    └── persistence/
        └── InMemoryUrlRepositoryTest.java  # Тесты хранилища
Ключевые тестовые сценарии
Создание и валидация коротких ссылок

Лимиты переходов и блокировка

Истечение срока жизни

Управление правами доступа

Обработка ошибок
